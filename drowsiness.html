<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIISER - Sleep Awaker</title>
    <link rel="stylesheet" href="project.css">
    <style>
        /* Custom styles for Drowsiness Detection */
        .workspace {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: #202124;
            color: white;
            min-height: 80vh;
        }

        .video-container {
            position: relative;
            margin: 20px auto;
            border: 4px solid #333;
            border-radius: 8px;
            overflow: hidden;
            width: 640px; 
            max-width: 90vw;
        }

        video {
            display: block; /* Hide default video, we render to canvas or show it? MediaPipe Tasks often uses video element source but we can overlay canvas */
            width: 100%;
            transform: scaleX(-1); /* Mirror effect */
        }
        
        canvas {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            transform: scaleX(-1); /* Mirror attributes too */
        }

        .controls {
            margin: 20px;
            display: flex;
            gap: 10px;
        }

        button.action-btn {
            background: linear-gradient(90deg, rgba(2,0,36,1) 8%, rgba(74,74,214,1) 15%, rgba(0,212,255,1) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button.action-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .stats-panel {
             display: grid;
             grid-template-columns: repeat(4, 1fr);
             gap: 15px;
             background: #333;
             padding: 15px;
             border-radius: 8px;
             margin-bottom: 20px;
        }

        .stat-card {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #aaa;
        }

        .alert-banner {
            width: 100%;
            text-align: center;
            padding: 10px;
            font-size: 24px;
            font-weight: bold;
            display: none; 
            margin-bottom: 10px;
        }
        
        .alert-critical {
            background-color: red;
            color: white;
            display: block;
            animation: blink 0.5s infinite;
        }

        .alert-warning {
            background-color: orange;
            color: black;
            display: block;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }
    </style>
    <!-- MediaPipe Usage -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <h1>Sleep Awaker</h1>
    </header>
    <nav>
        <a href="index.html" class="menu">Home</a>
        <a href="team.html" class="menu">Our Team</a>
        <a href="feedback.html" class="menu">Feedback</a>
        <a href="project.html" class="menu">Project</a>
        
    </nav>

    <section class="workspace">
        <div id="alertBanner" class="alert-banner">SAFE</div>

        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-value" id="scoreVal">0.00</div>
                <div class="stat-label">Risk Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="earVal">0.00</div>
                <div class="stat-label">EAR (Eyes)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="marVal">0.00</div>
                <div class="stat-label">MAR (Mouth)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statusVal">SAFE</div>
                <div class="stat-label">Status</div>
            </div>
        </div>

        <div class="video-container">
            <video id="webcam" autoplay playsinline></video>
            <canvas id="output_canvas"></canvas>
        </div>

        <div class="controls">
            <button id="enableWebcamButton" class="action-btn">ENABLE WEBCAM</button>
        </div>
        
        <p style="text-align: center; max-width: 600px; color: #ccc;">
            Ensure you are in a well-lit environment. The system monitors eye closure and yawning duration. <br>
            <strong>Permissions:</strong> Camera access is required. Audio will play upon Critical Alert.
        </p>
    </section>

    <!-- Audio Element for Siren -->
    <audio id="sirenAudio" src="siren.mp3" loop></audio>

    <script type="module" src="js/drowsiness.js"></script>
<script type="module" src="/js/sleep_awaker_widget.js"></script>
</body>
</html>
