<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiiser+ Professional CV Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #ec4899;
            --bg-page: #f3f4f6;
            --bg-panel: #ffffff;
            --text-heading: #1f2937;
            --text-body: #4b5563;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-page);
            color: var(--text-body);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* App-like feel */
        }

        /* Navigation */
        .navbar {
            background-color: white;
            border-bottom: 1px solid var(--border);
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 50;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-heading);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo span {
            color: var(--primary);
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            text-decoration: none;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-body);
        }

        .btn-ghost:hover {
            background: var(--bg-page);
            color: var(--text-heading);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* Main App Container */
        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            height: calc(100vh - 64px);
        }

        /* Left Panel - Editor */
        .editor-panel {
            width: 450px;
            background: white;
            border-right: 1px solid var(--border);
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .editor-section {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .editor-section h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-heading);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.35rem;
            color: var(--text-body);
        }

        .form-control {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        textarea.form-control {
            min-height: 80px;
            resize: vertical;
        }

        .dynamic-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .dynamic-item {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1rem;
            position: relative;
        }

        .btn-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            color: #ef4444;
            background: none;
            border: none;
            cursor: pointer;
            opacity: 0.6;
        }

        .btn-remove:hover {
            opacity: 1;
        }

        .btn-add {
            width: 100%;
            padding: 0.75rem;
            border: 2px dashed var(--border);
            background: transparent;
            color: var(--primary);
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: all 0.2s;
        }

        .btn-add:hover {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.05);
        }

        /* Right Panel - Preview Area */
        .preview-panel {
            flex: 1;
            background: #e5e7eb;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* The A4 Page */
        #cv-preview {
            width: 210mm;
            min-height: 297mm;
            background: white;
            box-shadow: var(--shadow-lg);
            padding: 40px;
            /* Reduced from 1in effectively */
            position: relative;
            transform-origin: top center;
        }

        /* CV Styles (The content itself) */
        .cv-grid {
            /* Basic layout inside CV */
            color: #1a1a1a;
        }

        .cv-header-section {
            border-bottom: 2px solid #2563eb;
            padding-bottom: 20px;
            margin-bottom: 25px;
        }

        .cv-name {
            font-size: 32px;
            font-weight: 800;
            text-transform: uppercase;
            color: #1e3a8a;
            /* Dark Blue */
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .cv-contact {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 14px;
            color: #4b5563;
        }

        .cv-contact-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .cv-section-title {
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            color: #2563eb;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 6px;
            margin-bottom: 12px;
            margin-top: 20px;
            letter-spacing: 0.5px;
        }

        .cv-item {
            margin-bottom: 12px;
        }

        .cv-item-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 2px;
        }

        .cv-item-title {
            font-weight: 700;
            font-size: 15px;
            color: #111827;
        }

        .cv-item-subtitle {
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .cv-item-meta {
            font-size: 13px;
            color: #6b7280;
            font-style: italic;
            text-align: right;
        }

        .cv-list {
            list-style: none;
            /* Custom bullets */
        }

        .cv-list li {
            position: relative;
            padding-left: 12px;
            margin-bottom: 3px;
            font-size: 14px;
            line-height: 1.5;
            color: #374151;
        }

        .cv-list li::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #2563eb;
            font-weight: bold;
        }

        /* Chips for skills */
        .cv-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .cv-chip {
            background: #eff6ff;
            color: #1e40af;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
        }

        /* Print Override */
        @media print {
            @page {
                margin: 0;
            }

            body {
                height: auto;
                background: white;
                display: block;
            }

            .navbar,
            .editor-panel {
                display: none;
            }

            .preview-panel {
                padding: 0;
                background: white;
                overflow: visible;
                display: block;
            }

            #cv-preview {
                box-shadow: none;
                margin: 0;
                width: 100%;
                min-height: auto;
                page-break-inside: avoid;
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
                overflow-y: auto;
                height: auto;
            }

            .editor-panel {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }

            .preview-panel {
                padding: 1rem;
            }

            #cv-preview {
                width: 100%;
                max-width: 800px;
                height: auto;
                min-height: auto;
                aspect-ratio: 210/297;
            }

            body {
                height: auto;
                overflow: auto;
            }
        }
    </style>
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-file-invoice"></i> Wiiser<span>+</span>
        </div>
        <div class="nav-actions">
            <a href="dashboard.html" class="btn btn-ghost"><i class="fas fa-chart-pie"></i> Dashboard</a>
            <a href="newindex.html" class="btn btn-ghost"> Back to Home</a>
            <button class="btn btn-primary" onclick="downloadPDF()">
                <i class="fas fa-download"></i> Download PDF
            </button>
        </div>
    </nav>

    <div class="app-container">
        <!-- Editor Sidebar -->
        <aside class="editor-panel">

            <!-- Personal Info -->
            <div class="editor-section">
                <h2><i class="fas fa-user-circle"></i> Personal Info</h2>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" class="form-control" id="p-name" placeholder="e.g. John Doe"
                        oninput="updateCV()">
                </div>
                <div class="form-group">
                    <label>Job Title</label>
                    <input type="text" class="form-control" id="p-title" placeholder="e.g. Software Engineer"
                        oninput="updateCV()">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-control" id="p-email" placeholder="john@example.com"
                        oninput="updateCV()">
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="text" class="form-control" id="p-phone" placeholder="+1 234 567 890"
                        oninput="updateCV()">
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" class="form-control" id="p-location" placeholder="New York, NY"
                        oninput="updateCV()">
                </div>
                <div class="form-group">
                    <label>Professional Summary</label>
                    <textarea class="form-control" id="p-summary" placeholder="Brief overview of your experience..."
                        oninput="updateCV()"></textarea>
                </div>
            </div>

            <!-- Education -->
            <div class="editor-section">
                <h2><i class="fas fa-graduation-cap"></i> Education</h2>
                <div id="edu-list" class="dynamic-list"></div>
                <button class="btn-add" onclick="addEducation()"><i class="fas fa-plus"></i> Add Education</button>
            </div>

            <!-- Experience -->
            <div class="editor-section">
                <h2><i class="fas fa-briefcase"></i> Experience</h2>
                <div id="exp-list" class="dynamic-list"></div>
                <button class="btn-add" onclick="addExperience()"><i class="fas fa-plus"></i> Add Experience</button>
            </div>

            <!-- Extracurricular Activities -->
            <div class="editor-section">
                <h2><i class="fas fa-running"></i> Extracurricular Activities</h2>
                <div id="extra-list" class="dynamic-list"></div>
                <button class="btn-add" onclick="addExtracurricular()"><i class="fas fa-plus"></i> Add Activity</button>
            </div>

            <!-- Projects -->
            <div class="editor-section">
                <h2><i class="fas fa-code-branch"></i> Projects</h2>
                <div id="proj-list" class="dynamic-list"></div>
                <button class="btn-add" onclick="addProject()"><i class="fas fa-plus"></i> Add Project</button>
            </div>

            <!-- Skills -->
            <div class="editor-section">
                <h2><i class="fas fa-tools"></i> Skills</h2>
                <div class="form-group">
                    <label>Technical Skills (comma separated)</label>
                    <textarea class="form-control" id="s-technical" placeholder="Java, Python, React..."
                        oninput="updateCV()"></textarea>
                </div>
                <div class="form-group">
                    <label>Soft Skills (comma separated)</label>
                    <textarea class="form-control" id="s-soft" placeholder="Leadership, Communication..."
                        oninput="updateCV()"></textarea>
                </div>
            </div>

        </aside>

        <!-- Preview Area -->
        <main class="preview-panel">
            <div id="cv-preview">
                <!-- Content will be injected here via JS -->
            </div>
        </main>
    </div>

    <script>
        // State Management
        let state = {
            personal: {
                name: "RAM KUMAR",
                title: "Student | IISER Pune",
                email: "ramkumar@gmail.com",
                phone: "(+91)9999955555 ",
                location: "Pune, India",
                summary: "I am Ram Kumar, a sophomore at IISER Pune pursuing a B.S.- M.S. with a strong foundation and a deep intrest in interaction of biology mathematics and computer science.My curioosity is fueled by a passion for understading complex sysytems."
            },
            education: [
                {
                    degree: "B.S.- M.S. Dual Degree Program",
                    school: "Indian Institute of Science Education and Research, Pune",
                    location: "Boston, MA",
                    year: "2024 - 2029",
                    details: "CGPA 8.5."
                },
                {
                    degree: "Class: XII (Science Stream)",
                    school: "Pune High School",
                    location: "Pune",
                    year: "2023 - 2024",
                    details: "Percentage: 97%"
                }
            ],
            experience: [
                {
                    role: "Senior UX Designer",
                    company: "TechFlow Solutions",
                    duration: "2021 - Present",
                    description: "Leading the design of the core platform products.\\nMentoring junior designers and establishing a unified design system."
                },
                {
                    role: "Product Designer",
                    company: "Creative Studio Inc.",
                    duration: "2019 - 2021",
                    description: "Collaborated with cross-functional teams to ship web and mobile apps."
                }
            ],
            projects: [
                {
                    name: "WIISER",
                    role: "Programmer",
                    duration: "2024",
                    description: "WIISER is a student driven academic platform build to foster academic collaboration at IISER Pune."
                }
            ],
            extracurricular: [
                {
                    name: "E-Cell IISER Pune",
                    role: "CTO",
                    duration: "2025 - 2026",
                    description: "Organized several competitions and hackathons."
                }
            ],
            skills: {
                technical: "Figma, , HTML/CSS, JavaScript, NumPy, Pandas, Astropy, Matplotlib",
                soft: "Communication, Team Leadership, Presentation, Problem Solving"
            }
        };

        // Initialize Form with default data
        function initForm() {
            // Personal
            document.getElementById('p-name').value = state.personal.name;
            document.getElementById('p-title').value = state.personal.title;
            document.getElementById('p-email').value = state.personal.email;
            document.getElementById('p-phone').value = state.personal.phone;
            document.getElementById('p-location').value = state.personal.location;
            document.getElementById('p-summary').value = state.personal.summary;

            // Skills
            document.getElementById('s-technical').value = state.skills.technical;
            document.getElementById('s-soft').value = state.skills.soft;

            // Dynamic Lists
            renderEducationInputs();
            renderExperienceInputs();
            renderExtracurricularInputs();
            renderProjectInputs();

            // Initial Render
            renderPreview();
        }

        // --- Render Inputs ---

        function renderEducationInputs() {
            const container = document.getElementById('edu-list');
            container.innerHTML = '';
            state.education.forEach((edu, index) => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `
                    <button class="btn-remove" onclick="removeEducation(${index})"><i class="fas fa-trash"></i></button>
                    <div class="form-group">
                        <label>Degree</label>
                        <input type="text" class="form-control" value="${edu.degree}" oninput="updateEducation(${index}, 'degree', this.value)">
                    </div>
                    <div class="form-group">
                        <label>School / Institution</label>
                        <input type="text" class="form-control" value="${edu.school}" oninput="updateEducation(${index}, 'school', this.value)">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <div class="form-group" style="flex: 1;">
                            <label>Year</label>
                            <input type="text" class="form-control" value="${edu.year}" oninput="updateEducation(${index}, 'year', this.value)">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Location</label>
                            <input type="text" class="form-control" value="${edu.location}" oninput="updateEducation(${index}, 'location', this.value)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Details (Optional)</label>
                        <textarea class="form-control" oninput="updateEducation(${index}, 'details', this.value)">${edu.details}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderExperienceInputs() {
            const container = document.getElementById('exp-list');
            container.innerHTML = '';
            state.experience.forEach((exp, index) => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `
                    <button class="btn-remove" onclick="removeExperience(${index})"><i class="fas fa-trash"></i></button>
                    <div class="form-group">
                        <label>Role / Position</label>
                        <input type="text" class="form-control" value="${exp.role}" oninput="updateExperience(${index}, 'role', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Company</label>
                        <input type="text" class="form-control" value="${exp.company}" oninput="updateExperience(${index}, 'company', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <input type="text" class="form-control" value="${exp.duration}" oninput="updateExperience(${index}, 'duration', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Description (Bullet points)</label>
                        <textarea class="form-control" rows="4" oninput="updateExperience(${index}, 'description', this.value)">${exp.description}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderProjectInputs() {
            const container = document.getElementById('proj-list');
            container.innerHTML = '';
            state.projects.forEach((proj, index) => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `
                    <button class="btn-remove" onclick="removeProject(${index})"><i class="fas fa-trash"></i></button>
                    <div class="form-group">
                        <label>Project Name</label>
                        <input type="text" class="form-control" value="${proj.name}" oninput="updateProject(${index}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <input type="text" class="form-control" value="${proj.role}" oninput="updateProject(${index}, 'role', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <input type="text" class="form-control" value="${proj.duration}" oninput="updateProject(${index}, 'duration', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" rows="3" oninput="updateProject(${index}, 'description', this.value)">${proj.description}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderExtracurricularInputs() {
            const container = document.getElementById('extra-list');
            container.innerHTML = '';
            state.extracurricular.forEach((extra, index) => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `
                    <button class="btn-remove" onclick="removeExtracurricular(${index})"><i class="fas fa-trash"></i></button>
                    <div class="form-group">
                        <label>Activity Name</label>
                        <input type="text" class="form-control" value="${extra.name}" oninput="updateExtracurricular(${index}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <input type="text" class="form-control" value="${extra.role}" oninput="updateExtracurricular(${index}, 'role', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <input type="text" class="form-control" value="${extra.duration}" oninput="updateExtracurricular(${index}, 'duration', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" rows="3" oninput="updateExtracurricular(${index}, 'description', this.value)">${extra.description}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });
        }


        // --- Update Functions ---

        // This function gathers data from the main personal/skills fields
        window.updateCV = function () {
            state.personal.name = document.getElementById('p-name').value;
            state.personal.title = document.getElementById('p-title').value;
            state.personal.email = document.getElementById('p-email').value;
            state.personal.phone = document.getElementById('p-phone').value;
            state.personal.location = document.getElementById('p-location').value;
            state.personal.summary = document.getElementById('p-summary').value;

            state.skills.technical = document.getElementById('s-technical').value;
            state.skills.soft = document.getElementById('s-soft').value;

            renderPreview();
        }

        window.updateEducation = function (index, field, value) {
            state.education[index][field] = value;
            renderPreview();
        }

        window.addEducation = function () {
            state.education.push({ degree: '', school: '', location: '', year: '', details: '' });
            renderEducationInputs();
            renderPreview();
        }

        window.removeEducation = function (index) {
            state.education.splice(index, 1);
            renderEducationInputs();
            renderPreview();
        }

        window.updateExperience = function (index, field, value) {
            state.experience[index][field] = value;
            renderPreview();
        }

        window.addExperience = function () {
            state.experience.push({ role: '', company: '', duration: '', description: '' });
            renderExperienceInputs();
            renderPreview();
        }

        window.removeExperience = function (index) {
            state.experience.splice(index, 1);
            renderExperienceInputs();
            renderPreview();
        }

        window.updateProject = function (index, field, value) {
            state.projects[index][field] = value;
            renderPreview();
        }

        window.addProject = function () {
            state.projects.push({ name: '', role: '', duration: '', description: '' });
            renderProjectInputs();
            renderPreview();
        }

        window.removeProject = function (index) {
            state.projects.splice(index, 1);
            renderProjectInputs();
            renderPreview();
        }

        window.updateExtracurricular = function (index, field, value) {
            state.extracurricular[index][field] = value;
            renderPreview();
        }

        window.addExtracurricular = function () {
            state.extracurricular.push({ name: '', role: '', duration: '', description: '' });
            renderExtracurricularInputs();
            renderPreview();
        }

        window.removeExtracurricular = function (index) {
            state.extracurricular.splice(index, 1);
            renderExtracurricularInputs();
            renderPreview();
        }

        // --- Render Preview (The Core Logic) ---

        function renderPreview() {
            const p = state.personal;

            // Format Description text to list items
            const formatList = (text) => {
                if (!text) return '';
                return text.split('\\n').filter(line => line.trim()).map(line => `<li>${line}</li>`).join('');
            };

            // Format Skills to chips
            const formatChips = (text) => {
                if (!text) return '';
                return text.split(',').filter(item => item.trim()).map(item => `<span class="cv-chip">${item.trim()}</span>`).join('');
            };

            const html = `
                <div class="cv-header-section">
                    <div class="cv-name">${p.name || 'Your Name'}</div>
                    <div style="font-size: 1.1em; color: #4338ca; font-weight: 500; margin-top:4px;">${p.title || ''}</div>
                    <div class="cv-contact">
                        ${p.phone ? `<div class="cv-contact-item"><i class="fas fa-phone-alt"></i> ${p.phone}</div>` : ''}
                        ${p.email ? `<div class="cv-contact-item"><i class="fas fa-envelope"></i> ${p.email}</div>` : ''}
                        ${p.location ? `<div class="cv-contact-item"><i class="fas fa-map-marker-alt"></i> ${p.location}</div>` : ''}
                    </div>
                </div>

                ${p.summary ? `
                    <div class="cv-section-title">Professional Profile</div>
                    <p style="font-size: 14px; line-height: 1.6; margin-bottom: 20px;">${p.summary}</p>
                ` : ''}

                ${state.education.length > 0 ? `
                    <div class="cv-section-title">Education</div>
                    ${state.education.map(edu => `
                        <div class="cv-item">
                            <div class="cv-item-header">
                                <div class="cv-item-title">${edu.school}</div>
                                <div class="cv-item-meta">${edu.year}</div>
                            </div>
                            <div class="cv-item-subtitle">${edu.degree} ${edu.location ? `| ${edu.location}` : ''}</div>
                            ${edu.details ? `<div style="font-size: 13px; color: #555; margin-top: 4px;">${edu.details}</div>` : ''}
                        </div>
                    `).join('')}
                ` : ''}

                ${state.experience.length > 0 ? `
                    <div class="cv-section-title">Professional Experience</div>
                    ${state.experience.map(exp => `
                        <div class="cv-item">
                            <div class="cv-item-header">
                                <div class="cv-item-title">${exp.role} | ${exp.company}</div>
                                <div class="cv-item-meta">${exp.duration}</div>
                            </div>
                            <ul class="cv-list">
                                ${formatList(exp.description)}
                            </ul>
                        </div>
                    `).join('')}
                ` : ''}

                ${state.extracurricular && state.extracurricular.length > 0 ? `
                    <div class="cv-section-title">Extracurricular Activities</div>
                    ${state.extracurricular.map(extra => `
                        <div class="cv-item">
                            <div class="cv-item-header">
                                <div class="cv-item-title">${extra.role} | ${extra.name}</div>
                                <div class="cv-item-meta">${extra.duration}</div>
                            </div>
                            <ul class="cv-list">
                                ${formatList(extra.description)}
                            </ul>
                        </div>
                    `).join('')}
                ` : ''}

                ${state.projects.length > 0 ? `
                    <div class="cv-section-title">Projects</div>
                    ${state.projects.map(proj => `
                        <div class="cv-item">
                            <div class="cv-item-header">
                                <div class="cv-item-title">${proj.name}</div>
                                <div class="cv-item-meta">${proj.duration}</div>
                            </div>
                             ${proj.role ? `<div class="cv-item-subtitle" style="margin-bottom:6px;">${proj.role}</div>` : ''}
                            <ul class="cv-list">
                                ${formatList(proj.description)}
                            </ul>
                        </div>
                    `).join('')}
                ` : ''}

                <div class="cv-section-title">Skills</div>
                <div style="margin-bottom: 15px;">
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 6px;">Technical Skills</div>
                    <div class="cv-chips">${formatChips(state.skills.technical)}</div>
                </div>
                <div>
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 6px;">Soft Skills</div>
                    <div class="cv-chips">${formatChips(state.skills.soft)}</div>
                </div>
            `;

            document.getElementById('cv-preview').innerHTML = html;
        }

        // --- PDF Download ---
        function downloadPDF() {
            const element = document.getElementById('cv-preview');
            // Clone the element to remove shadow/transform for print
            // actually html2pdf handles this well if we just target the element

            const opt = {
                margin: 0,
                filename: 'resume.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Add loading state
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';

            html2pdf().set(opt).from(element).save().then(() => {
                btn.innerHTML = originalText;
            });
        }

        // Run
        initForm();

    </script>
</body>

</html>